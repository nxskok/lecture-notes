{
  "hash": "44125a7dc2644a91b1d5d2cb4cdf8843",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analysis of Covariance\"\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n\n\n## Analysis of covariance\n\n-   ANOVA: explanatory variables categorical (divide data into groups)\n\n-   traditionally, analysis of covariance has categorical $x$'s plus one\n    numerical $x$ (\"covariate\") to be adjusted for.\n\n-   `lm` handles this too.\n\n-   Simple example: two treatments (drugs) (`a` and `b`), with before\n    and after scores.\n\n-   Does knowing before score and/or treatment help to predict after\n    score?\n\n-   Is after score different by treatment/before score?\n\n## Data: treatment, before, after\n\n\n\\footnotesize\n\n\n```         \na 5 20\na 10 23\na 12 30\na 9 25\na 23 34\na 21 40\na 14 27\na 18 38\na 6 24\na 13 31\nb 7 19\nb 12 26\nb 27 33\nb 24 35\nb 18 30\nb 22 31\nb 26 34\nb 21 28\nb 14 23\nb 9 22\n```\n\n\\normalsize\n\n## Packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(marginaleffects)\n```\n:::\n\n\n\n\nthe last of these for predictions.\n\n## Read in data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"http://ritsokiguess.site/datafiles/ancova.txt\"\nprepost <- read_delim(url, \" \")\nprepost\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 20 x 3\n   drug  before after\n   <chr>  <dbl> <dbl>\n 1 a          5    20\n 2 a         10    23\n 3 a         12    30\n 4 a          9    25\n 5 a         23    34\n 6 a         21    40\n 7 a         14    27\n 8 a         18    38\n 9 a          6    24\n10 a         13    31\n11 b          7    19\n12 b         12    26\n13 b         27    33\n14 b         24    35\n15 b         18    30\n16 b         22    31\n17 b         26    34\n18 b         21    28\n19 b         14    23\n20 b          9    22\n```\n\n\n:::\n:::\n\n\n\n\n## Making a plot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(prepost, aes(x = before, y = after, colour = drug)) +\n  geom_point() + geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](ancova_files/figure-beamer/ancova-plot-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## Comments\n\n-   As before score goes up, after score goes up.\n\n-   Red points (drug A) generally above blue points (drug B), for\n    comparable before score.\n\n-   Suggests before score effect *and* drug effect.\n\n## The means\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprepost %>%\n  group_by(drug) %>%\n  summarize(\n    before_mean = mean(before),\n    after_mean = mean(after)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 x 3\n  drug  before_mean after_mean\n  <chr>       <dbl>      <dbl>\n1 a            13.1       29.2\n2 b            18         28.1\n```\n\n\n:::\n:::\n\n\n\n\n-   Mean \"after\" score slightly higher for treatment A.\n\n-   Mean \"before\" score much higher for treatment B.\n\n-   Greater *improvement* on treatment A.\n\n## Testing for interaction\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprepost.1 <- lm(after ~ before * drug, data = prepost)\ndrop1(prepost.1, test = \"F\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSingle term deletions\n\nModel:\nafter ~ before * drug\n            Df Sum of Sq    RSS    AIC F value Pr(>F)\n<none>                   109.98 42.092               \nbefore:drug  1    12.337 122.32 42.218  1.7948 0.1991\n```\n\n\n:::\n:::\n\n\n\n\n-   Interaction not significant. Will remove later.\n\n## Predictions\n\nSet up values to predict for, median and quartiles for `before`, the two `drug`s:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew <- datagrid(before = c(9.75, 14, 21.25), \n                drug = c(\"a\", \"b\"), model = prepost.1)\nnew\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  before drug rowid\n1   9.75    a     1\n2   9.75    b     2\n3  14.00    a     3\n4  14.00    b     4\n5  21.25    a     5\n6  21.25    b     6\n```\n\n\n:::\n:::\n\n\n\n\n## and then\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbind(predictions(prepost.1, newdata = new)) %>% \n  select(drug, before, estimate, conf.low, conf.high)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  drug before estimate conf.low conf.high\n1    a   9.75 25.93250 24.05059  27.81442\n2    b   9.75 22.14565 19.58681  24.70450\n3    a  14.00 30.07784 28.43296  31.72271\n4    b  14.00 25.21304 23.32649  27.09959\n5    a  21.25 37.14929 34.32557  39.97300\n6    b  21.25 30.44565 28.64373  32.24758\n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Predictions (with interaction included), plotted\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(model = prepost.1, \n                 condition = c(\"before\", \"drug\"))\n```\n\n::: {.cell-output-display}\n![](ancova_files/figure-beamer/unnamed-chunk-3-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\nLines almost parallel, but not quite.\n\n## Taking out interaction\n\n\\small\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprepost.2 <- update(prepost.1, . ~ . - before:drug)\ndrop1(prepost.2, test = \"F\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSingle term deletions\n\nModel:\nafter ~ before + drug\n       Df Sum of Sq    RSS    AIC F value    Pr(>F)    \n<none>              122.32 42.218                      \nbefore  1    540.18 662.50 74.006  75.074 1.211e-07 ***\ndrug    1    115.31 237.63 53.499  16.025 0.0009209 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n-   Take out non-significant interaction.\n\n-   `before` and `drug` strongly significant.\n\n-   Do predictions again and plot them.\n\n## Predictions\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbind(predictions(prepost.2, newdata = new)) %>% \n  select(drug, before, estimate)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  drug before estimate\n1    a   9.75 26.42794\n2    b   9.75 21.27328\n3    a  14.00 29.94473\n4    b  14.00 24.79007\n5    a  21.25 35.94397\n6    b  21.25 30.78931\n```\n\n\n:::\n:::\n\n\n\n\n## Plot of predicted values\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(prepost.2, condition = c(\"before\", \"drug\"))\n```\n\n::: {.cell-output-display}\n![](ancova_files/figure-beamer/unnamed-chunk-5-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\nThis time the lines are *exactly* parallel. No-interaction model forces\nthem to have the same slope.\n\n## Different look at model output\n\n-   `drop1(prepost.2)` tests for significant effect of before score and\n    of drug, but doesn't help with interpretation.\n\n-   `summary(prepost.2)` views as regression with slopes:\n\n\\scriptsize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(prepost.2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = after ~ before + drug, data = prepost)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.6348 -2.5099 -0.2038  1.8871  4.7453 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  18.3600     1.5115  12.147 8.35e-10 ***\nbefore        0.8275     0.0955   8.665 1.21e-07 ***\ndrugb        -5.1547     1.2876  -4.003 0.000921 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.682 on 17 degrees of freedom\nMultiple R-squared:  0.817,\tAdjusted R-squared:  0.7955 \nF-statistic: 37.96 on 2 and 17 DF,  p-value: 5.372e-07\n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Understanding those slopes\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(prepost.2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 x 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)   18.4      1.51       12.1  8.35e-10\n2 before         0.827    0.0955      8.66 1.21e- 7\n3 drugb         -5.15     1.29       -4.00 9.21e- 4\n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n-   `before` ordinary numerical variable; `drug` categorical.\n\n-   `lm` uses first category `druga` as baseline.\n\n-   Intercept is prediction of after score for before score 0 and *drug\n    A*.\n\n-   `before` slope is predicted change in after score when before score\n    increases by 1 (usual slope)\n\n-   Slope for `drugb` is *change* in predicted after score for being on\n    drug B rather than drug A. Same for *any* before score (no\n    interaction).\n\n## Summary\n\n-   ANCOVA model: fits different regression line for each group,\n    predicting response from covariate.\n\n-   ANCOVA model with interaction between factor and covariate allows\n    different slopes for each line.\n\n-   Sometimes those lines can cross over!\n\n-   If interaction not significant, take out. Lines then parallel.\n\n-   With parallel lines, groups have consistent effect regardless of\n    value of covariate.\n",
    "supporting": [
      "ancova_files/figure-beamer"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}