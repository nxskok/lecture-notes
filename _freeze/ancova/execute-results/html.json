{
  "hash": "44125a7dc2644a91b1d5d2cb4cdf8843",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analysis of Covariance\"\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n\n\n## Analysis of covariance\n\n-   ANOVA: explanatory variables categorical (divide data into groups)\n\n-   traditionally, analysis of covariance has categorical $x$'s plus one\n    numerical $x$ (\"covariate\") to be adjusted for.\n\n-   `lm` handles this too.\n\n-   Simple example: two treatments (drugs) (`a` and `b`), with before\n    and after scores.\n\n-   Does knowing before score and/or treatment help to predict after\n    score?\n\n-   Is after score different by treatment/before score?\n\n## Data: treatment, before, after\n\n\n\\footnotesize\n\n\n```         \na 5 20\na 10 23\na 12 30\na 9 25\na 23 34\na 21 40\na 14 27\na 18 38\na 6 24\na 13 31\nb 7 19\nb 12 26\nb 27 33\nb 24 35\nb 18 30\nb 22 31\nb 26 34\nb 21 28\nb 14 23\nb 9 22\n```\n\n\\normalsize\n\n## Packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(marginaleffects)\n```\n:::\n\n\n\n\nthe last of these for predictions.\n\n## Read in data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"http://ritsokiguess.site/datafiles/ancova.txt\"\nprepost <- read_delim(url, \" \")\nprepost\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"drug\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"before\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"after\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"a\",\"2\":\"5\",\"3\":\"20\"},{\"1\":\"a\",\"2\":\"10\",\"3\":\"23\"},{\"1\":\"a\",\"2\":\"12\",\"3\":\"30\"},{\"1\":\"a\",\"2\":\"9\",\"3\":\"25\"},{\"1\":\"a\",\"2\":\"23\",\"3\":\"34\"},{\"1\":\"a\",\"2\":\"21\",\"3\":\"40\"},{\"1\":\"a\",\"2\":\"14\",\"3\":\"27\"},{\"1\":\"a\",\"2\":\"18\",\"3\":\"38\"},{\"1\":\"a\",\"2\":\"6\",\"3\":\"24\"},{\"1\":\"a\",\"2\":\"13\",\"3\":\"31\"},{\"1\":\"b\",\"2\":\"7\",\"3\":\"19\"},{\"1\":\"b\",\"2\":\"12\",\"3\":\"26\"},{\"1\":\"b\",\"2\":\"27\",\"3\":\"33\"},{\"1\":\"b\",\"2\":\"24\",\"3\":\"35\"},{\"1\":\"b\",\"2\":\"18\",\"3\":\"30\"},{\"1\":\"b\",\"2\":\"22\",\"3\":\"31\"},{\"1\":\"b\",\"2\":\"26\",\"3\":\"34\"},{\"1\":\"b\",\"2\":\"21\",\"3\":\"28\"},{\"1\":\"b\",\"2\":\"14\",\"3\":\"23\"},{\"1\":\"b\",\"2\":\"9\",\"3\":\"22\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n## Making a plot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(prepost, aes(x = before, y = after, colour = drug)) +\n  geom_point() + geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](ancova_files/figure-revealjs/ancova-plot-1.png){width=960}\n:::\n:::\n\n\n\n\n## Comments\n\n-   As before score goes up, after score goes up.\n\n-   Red points (drug A) generally above blue points (drug B), for\n    comparable before score.\n\n-   Suggests before score effect *and* drug effect.\n\n## The means\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprepost %>%\n  group_by(drug) %>%\n  summarize(\n    before_mean = mean(before),\n    after_mean = mean(after)\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"drug\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"before_mean\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"after_mean\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"a\",\"2\":\"13.1\",\"3\":\"29.2\"},{\"1\":\"b\",\"2\":\"18.0\",\"3\":\"28.1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n-   Mean \"after\" score slightly higher for treatment A.\n\n-   Mean \"before\" score much higher for treatment B.\n\n-   Greater *improvement* on treatment A.\n\n## Testing for interaction\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprepost.1 <- lm(after ~ before * drug, data = prepost)\ndrop1(prepost.1, test = \"F\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Df\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Sum of Sq\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"RSS\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"AIC\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"F value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Pr(>F)\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"NA\",\"2\":\"NA\",\"3\":\"109.9831\",\"4\":\"42.09189\",\"5\":\"NA\",\"6\":\"NA\",\"_rn_\":\"<none>\"},{\"1\":\"1\",\"2\":\"12.33708\",\"3\":\"122.3202\",\"4\":\"42.21820\",\"5\":\"1.79476\",\"6\":\"0.1990662\",\"_rn_\":\"before:drug\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n-   Interaction not significant. Will remove later.\n\n## Predictions\n\nSet up values to predict for, median and quartiles for `before`, the two `drug`s:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew <- datagrid(before = c(9.75, 14, 21.25), \n                drug = c(\"a\", \"b\"), model = prepost.1)\nnew\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"before\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"drug\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"rowid\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"9.75\",\"2\":\"a\",\"3\":\"1\"},{\"1\":\"9.75\",\"2\":\"b\",\"3\":\"2\"},{\"1\":\"14.00\",\"2\":\"a\",\"3\":\"3\"},{\"1\":\"14.00\",\"2\":\"b\",\"3\":\"4\"},{\"1\":\"21.25\",\"2\":\"a\",\"3\":\"5\"},{\"1\":\"21.25\",\"2\":\"b\",\"3\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n## and then\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbind(predictions(prepost.1, newdata = new)) %>% \n  select(drug, before, estimate, conf.low, conf.high)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"drug\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"before\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"estimate\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.low\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.high\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"a\",\"2\":\"9.75\",\"3\":\"25.93250\",\"4\":\"24.05059\",\"5\":\"27.81442\"},{\"1\":\"b\",\"2\":\"9.75\",\"3\":\"22.14565\",\"4\":\"19.58681\",\"5\":\"24.70450\"},{\"1\":\"a\",\"2\":\"14.00\",\"3\":\"30.07784\",\"4\":\"28.43296\",\"5\":\"31.72271\"},{\"1\":\"b\",\"2\":\"14.00\",\"3\":\"25.21304\",\"4\":\"23.32649\",\"5\":\"27.09959\"},{\"1\":\"a\",\"2\":\"21.25\",\"3\":\"37.14929\",\"4\":\"34.32557\",\"5\":\"39.97300\"},{\"1\":\"b\",\"2\":\"21.25\",\"3\":\"30.44565\",\"4\":\"28.64373\",\"5\":\"32.24758\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Predictions (with interaction included), plotted\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(model = prepost.1, \n                 condition = c(\"before\", \"drug\"))\n```\n\n::: {.cell-output-display}\n![](ancova_files/figure-revealjs/unnamed-chunk-3-1.png){width=960}\n:::\n:::\n\n\n\n\nLines almost parallel, but not quite.\n\n## Taking out interaction\n\n\\small\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprepost.2 <- update(prepost.1, . ~ . - before:drug)\ndrop1(prepost.2, test = \"F\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Df\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Sum of Sq\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"RSS\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"AIC\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"F value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Pr(>F)\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"NA\",\"2\":\"NA\",\"3\":\"122.3202\",\"4\":\"42.21820\",\"5\":\"NA\",\"6\":\"NA\",\"_rn_\":\"<none>\"},{\"1\":\"1\",\"2\":\"540.1798\",\"3\":\"662.5000\",\"4\":\"74.00577\",\"5\":\"75.07391\",\"6\":\"1.211339e-07\",\"_rn_\":\"before\"},{\"1\":\"1\",\"2\":\"115.3060\",\"3\":\"237.6262\",\"4\":\"53.49933\",\"5\":\"16.02516\",\"6\":\"9.209111e-04\",\"_rn_\":\"drug\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n-   Take out non-significant interaction.\n\n-   `before` and `drug` strongly significant.\n\n-   Do predictions again and plot them.\n\n## Predictions\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbind(predictions(prepost.2, newdata = new)) %>% \n  select(drug, before, estimate)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"drug\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"before\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"estimate\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"a\",\"2\":\"9.75\",\"3\":\"26.42794\"},{\"1\":\"b\",\"2\":\"9.75\",\"3\":\"21.27328\"},{\"1\":\"a\",\"2\":\"14.00\",\"3\":\"29.94473\"},{\"1\":\"b\",\"2\":\"14.00\",\"3\":\"24.79007\"},{\"1\":\"a\",\"2\":\"21.25\",\"3\":\"35.94397\"},{\"1\":\"b\",\"2\":\"21.25\",\"3\":\"30.78931\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n## Plot of predicted values\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(prepost.2, condition = c(\"before\", \"drug\"))\n```\n\n::: {.cell-output-display}\n![](ancova_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n\n\nThis time the lines are *exactly* parallel. No-interaction model forces\nthem to have the same slope.\n\n## Different look at model output\n\n-   `drop1(prepost.2)` tests for significant effect of before score and\n    of drug, but doesn't help with interpretation.\n\n-   `summary(prepost.2)` views as regression with slopes:\n\n\\scriptsize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(prepost.2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = after ~ before + drug, data = prepost)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.6348 -2.5099 -0.2038  1.8871  4.7453 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  18.3600     1.5115  12.147 8.35e-10 ***\nbefore        0.8275     0.0955   8.665 1.21e-07 ***\ndrugb        -5.1547     1.2876  -4.003 0.000921 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.682 on 17 degrees of freedom\nMultiple R-squared:  0.817,\tAdjusted R-squared:  0.7955 \nF-statistic: 37.96 on 2 and 17 DF,  p-value: 5.372e-07\n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Understanding those slopes\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(prepost.2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"term\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"(Intercept)\",\"2\":\"18.3599949\",\"3\":\"1.51153263\",\"4\":\"12.146608\",\"5\":\"8.354496e-10\"},{\"1\":\"before\",\"2\":\"0.8274813\",\"3\":\"0.09550226\",\"4\":\"8.664520\",\"5\":\"1.211339e-07\"},{\"1\":\"drugb\",\"2\":\"-5.1546584\",\"3\":\"1.28765245\",\"4\":\"-4.003144\",\"5\":\"9.209111e-04\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n-   `before` ordinary numerical variable; `drug` categorical.\n\n-   `lm` uses first category `druga` as baseline.\n\n-   Intercept is prediction of after score for before score 0 and *drug\n    A*.\n\n-   `before` slope is predicted change in after score when before score\n    increases by 1 (usual slope)\n\n-   Slope for `drugb` is *change* in predicted after score for being on\n    drug B rather than drug A. Same for *any* before score (no\n    interaction).\n\n## Summary\n\n-   ANCOVA model: fits different regression line for each group,\n    predicting response from covariate.\n\n-   ANCOVA model with interaction between factor and covariate allows\n    different slopes for each line.\n\n-   Sometimes those lines can cross over!\n\n-   If interaction not significant, take out. Lines then parallel.\n\n-   With parallel lines, groups have consistent effect regardless of\n    value of covariate.\n",
    "supporting": [
      "ancova_files/figure-revealjs"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"ancova_files/libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"ancova_files/libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}