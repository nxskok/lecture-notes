{
  "hash": "e7568d7d19293f766f7a75279d4a1671",
  "result": {
    "markdown": "---\ntitle: \"Statistical Inference: power\"\nauthor: \"\"\nheader-includes:\n   - \\usepackage{multicol}\noutput: \n  beamer_presentation:\n    latex_engine: lualatex\n    slide_level: 2\n    df_print: kable\n    theme: \"AnnArbor\"\n    colortheme: \"dove\"\nurlcolor: blue\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n## Errors in testing\n\nWhat can happen:\n\n\\begin{center}\n\\begin{tabular}{|l|cc|}\n\\hline\n  & \\multicolumn{2}{c|}{Decision}\\\\\nTruth & Do not reject & Reject null\\\\\n\\hline\nNull true & Correct & Type I error\\\\\nNull false & Type II error & Correct\\\\\n\\hline\n\\end{tabular}  \n\\end{center}\n\nTension between truth and decision about truth (imperfect).\n\n- Prob. of type I error denoted $\\alpha$. Usually fix $\\alpha$, eg. $\\alpha = 0.05$.\n- Prob. of type II error denoted $\\beta$. Determined by the planned\nexperiment. Low $\\beta$ good.\n- Prob. of not making type II error called **power** (= $1 - \\beta$). *High* power\ngood.\n\n## Power \n\n- Suppose $H_0 : \\theta = 10$, $H a : \\theta \\ne 10$ for some parameter $\\theta$.\n- Suppose $H_0$ wrong. What does that say about $\\theta$?\n- Not much. Could have $\\theta = 11$ or $\\theta = 8$ or $\\theta = 496$. In each case, $H_0$\nwrong.\n- How likely a type II error is depends on what $\\theta$ is:\n  - If $\\theta = 496$, should be able to reject $H_0 : \\theta = 10$ even for small sample,\nso $\\beta$ should be small (power large).\n  - If $\\theta = 11$, might have hard time rejecting $H_0$ even with large sample, so\n$\\beta$ would be larger (power smaller).\n- Power depends on true parameter value, and on sample size.\n- So we play “what if”: “if $\\theta$ were 11 (or 8 or 496), what would power\nbe?”.\n\n## Figuring out power\n- Time to figure out power is before you collect any data, as part of\nplanning process.\n- Need to have idea of what kind of departure from null hypothesis of\ninterest to you, eg. average improvement of 5 points on reading test\nscores. (Subject-matter decision, not statistical one.)\n- Then, either:\n  - “I have this big a sample and this big a departure I want to detect.\nWhat is my power for detecting it?”\n  - “I want to detect this big a departure with this much power. How big a\nsample size do I need?”\n\n## How to understand/estimate power?\n\n- Suppose we test $H_0 : \\mu = 10$ against $H_a : \\mu \\ne 10$, where $\\mu$ is\npopulation mean.\n- Suppose in actual fact, $\\mu = 8$, so $H_0$ is wrong. We want to reject it.\nHow likely is that to happen?\n- Need population SD (take $\\sigma = 4$) and sample size (take $n = 15$). In\npractice, get $\\sigma$ from pilot/previous study, and take the $n$ we plan to\nuse.\n- Idea: draw a random sample from the true distribution, test whether\nits mean is 10 or not.\n- Repeat previous step “many” times.\n- “Simulation”.\n\n## Making it go\n- Random sample of 15 normal observations with mean 8 and SD 4:\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx  <-  rnorm(15, 8, 4)\nx\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 14.487469  5.014611  6.924277  5.201860\n [5]  8.852952 10.835874  3.686684 11.165242\n [9]  8.016188 12.383518  1.378099  3.172503\n[13] 13.074996 11.353573  5.015575\n```\n:::\n:::\n\n- Test whether `x` from population with mean 10 or not (over):\n\n\n## ...continued\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(x, mu = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tOne Sample t-test\n\ndata:  x\nt = -1.8767, df = 14, p-value = 0.08157\nalternative hypothesis: true mean is not equal to 10\n95 percent confidence interval:\n  5.794735 10.280387\nsample estimates:\nmean of x \n 8.037561 \n```\n:::\n:::\n\n\n- Fail to reject the mean being 10 (a Type II error).\n\n## or get just P-value \n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(x, mu = 10)$p.value\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.0815652\n```\n:::\n:::\n\n\n\n## Run this lots of times\n\n- without a loop!\n- use `rowwise` to work one random sample at a time\n- draw random samples from the truth\n- test that $\\mu = 10$\n- get P-value\n- Count up how many of the P-values are 0.05 or less.\n\n## In code\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(sim = 1:1000) %>% \n  rowwise() %>% \n  mutate(my_sample = list(rnorm(35, 8, 4))) %>% \n  mutate(t_test = list(t.test(my_sample, mu = 10))) %>% \n  mutate(p_val = t_test$p.value) %>% \n  count(p_val <= 0.05)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 2\n# Rowwise: \n  `p_val <= 0.05`     n\n  <lgl>           <int>\n1 FALSE             186\n2 TRUE              814\n```\n:::\n:::\n\nWe correctly rejected 422 times out of 1000, so the estimated power is\n0.422.\n\n\n## Calculating power\n\n- Simulation approach very flexible: will work for any test. But answer\ndifferent each time because of randomness.\n- In some cases, for example 1-sample and 2-sample t-tests, power can\nbe calculated.\n- `power.t.test`. delta difference between null and true mean: \n\n\\small\n::: {.cell}\n\n```{.r .cell-code}\npower.t.test(n = 15, delta = 10-8, sd = 4, type = \"one.sample\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n     One-sample t test power calculation \n\n              n = 15\n          delta = 2\n             sd = 4\n      sig.level = 0.05\n          power = 0.4378466\n    alternative = two.sided\n```\n:::\n:::\n\\normalsize\n\n## Comparison of results\n\n  \\begin{center}\n  \\begin{tabular}{lr}\n    Method & Power\\\\\n    \\hline\n    Simulation & 0.422\\\\\n    \\texttt{power.t.test} & 0.4378\\\\\n    \\hline\n  \\end{tabular}\n    \n  \\end{center}\n\n- Simulation power is similar to calculated power; to get more accurate\nvalue, repeat more times (eg. 10,000 instead of 1,000), which takes\nlonger.\n- CI for power based on simulation approx. $0.42 \\pm 0.03$.\n- With this small a sample size, the power is not great. With a bigger\nsample, the sample mean should be closer to 8 most of the time, so\nwould reject $H_0 : \\mu = 10$ more often.\n\n## Calculating required sample size \n\n- Often, when planning a study, we do not have a particular sample size\nin mind. Rather, we want to know how big a sample to take. This\ncan be done by asking how big a sample is needed to achieve a\ncertain power.\n- The simulation approach does not work naturally with this, since you\nhave to supply a sample size.\n- For the power-calculation method, you supply a value for the power,\nbut leave the sample size missing.\n- Re-use the same problem: $H_0 : \\mu = 10$ against 2-sided alternative,\ntrue $\\mu = 8$, $\\sigma = 4$, but now aim for power 0.80.\n\n## Using power.t.test\n- No `n=`, replaced by a `power=`:\n\n::: {.cell}\n\n```{.r .cell-code}\npower.t.test(power=0.80, delta=10-8, sd=4, type=\"one.sample\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n     One-sample t test power calculation \n\n              n = 33.3672\n          delta = 2\n             sd = 4\n      sig.level = 0.05\n          power = 0.8\n    alternative = two.sided\n```\n:::\n:::\n\n- Sample size must be a whole number, so round up to 34 (to get at\nleast as much power as you want).\n\n## Power curves\n- Rather than calculating power for one sample size, or sample size for\none power, might want a picture of relationship between sample size\nand power.\n- Or, likewise, picture of relationship between difference between true\nand null-hypothesis means and power.\n- Called power curve.\n- Build and plot it yourself.\n\n## Building it\n- If you feed power.t.test a collection (“vector”) of values, it will do\ncalculation for each one.\n- Do power for variety of sample sizes, from 10 to 100 in steps of 10:\n\n::: {.cell}\n\n```{.r .cell-code}\nns <- seq(10,100,10)\nns\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1]  10  20  30  40  50  60  70  80  90 100\n```\n:::\n:::\n\n\n\\small\n\n- Calculate powers:\n::: {.cell}\n\n```{.r .cell-code}\nans <- power.t.test(n=ns, delta=10-8, sd=4, type=\"one.sample\")\nans$power\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 0.2928286 0.5644829 0.7539627 0.8693979\n [5] 0.9338976 0.9677886 0.9847848 0.9929987\n [9] 0.9968496 0.9986097\n```\n:::\n:::\n\n\\normalsize\n\n\n## Building a plot (1/2)\n- Make a data frame out of the values to plot:\n::: {.cell}\n\n```{.r .cell-code}\nd <- tibble(n=ns, power=ans$power)\nd\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 x 2\n       n power\n   <dbl> <dbl>\n 1    10 0.293\n 2    20 0.564\n 3    30 0.754\n 4    40 0.869\n 5    50 0.934\n 6    60 0.968\n 7    70 0.985\n 8    80 0.993\n 9    90 0.997\n10   100 0.999\n```\n:::\n:::\n\n## Building a plot (2/2)\n\n- Plot these as points joined by lines, and add horizontal line at 1\n(maximum power): \n::: {.cell}\n\n```{.r .cell-code}\ng  <-  ggplot(d, aes(x = n, y = power)) + geom_point() + \n  geom_line() + \n  geom_hline(yintercept = 1, linetype = \"dashed\")\n```\n:::\n\n## The power curve\n::: {.cell}\n\n```{.r .cell-code}\ng\n```\n\n::: {.cell-output-display}\n![](inference_2_R_slides_files/figure-beamer/inference-2-R-13-1.pdf)\n:::\n:::\n\n## Another way to do it:\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(n=ns) %>% rowwise() %>%\n  mutate(power_output = \n           list(power.t.test(n = n, delta = 10-8, sd = 4, \n                             type = \"one.sample\"))) %>% \n  mutate(power = power_output$power) %>% \n  ggplot(aes(x=n, y=power)) + geom_point() + geom_line() +\n    geom_hline(yintercept=1, linetype=\"dashed\") -> g2\n```\n:::\n\n## The power curve done the other way\n\n::: {.cell}\n\n```{.r .cell-code}\ng2\n```\n\n::: {.cell-output-display}\n![](inference_2_R_slides_files/figure-beamer/inference-2-R-15-1.pdf)\n:::\n:::\n\n\n## Power curves for means\n\n- Can also investigate power as it depends on what the true mean is\n(the farther from null mean 10, the higher the power\nwill be).\n- Investigate for two different sample sizes, 15 and 30.\n- First make all combos of mean and sample size:\n\n::: {.cell}\n\n```{.r .cell-code}\nmeans <- seq(6,10,0.5)\nmeans\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  6.0  6.5  7.0  7.5  8.0  8.5  9.0  9.5 10.0\n```\n:::\n\n```{.r .cell-code}\nns <- c(15,30)\nns\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 15 30\n```\n:::\n\n```{.r .cell-code}\ncombos <- crossing(mean=means, n=ns)\n```\n:::\n\n## The combos\n\n\\scriptsize\n\n::: {.cell}\n\n```{.r .cell-code}\ncombos\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 18 x 2\n    mean     n\n   <dbl> <dbl>\n 1   6      15\n 2   6      30\n 3   6.5    15\n 4   6.5    30\n 5   7      15\n 6   7      30\n 7   7.5    15\n 8   7.5    30\n 9   8      15\n10   8      30\n11   8.5    15\n12   8.5    30\n13   9      15\n14   9      30\n15   9.5    15\n16   9.5    30\n17  10      15\n18  10      30\n```\n:::\n:::\n\n\\normalsize\n\n## Calculate and plot\n\n- Calculate the powers, carefully:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nans <- with(combos, power.t.test(n=n, delta=10-mean, sd=4, \n                              type=\"one.sample\"))\nans$power\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 0.94908647 0.99956360 0.88277128 0.99619287\n [5] 0.77070660 0.97770385 0.61513033 0.91115700\n [9] 0.43784659 0.75396272 0.27216777 0.51028173\n[13] 0.14530058 0.26245348 0.06577280 0.09719303\n[17] 0.02500000 0.02500000\n```\n:::\n:::\n\n \n\n##  Make a data frame to plot, pulling things from the right places:\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- tibble(n=factor(combos$n), mean=combos$mean, \n         power=ans$power)\nd\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 18 x 3\n   n      mean  power\n   <fct> <dbl>  <dbl>\n 1 15      6   0.949 \n 2 30      6   1.00  \n 3 15      6.5 0.883 \n 4 30      6.5 0.996 \n 5 15      7   0.771 \n 6 30      7   0.978 \n 7 15      7.5 0.615 \n 8 30      7.5 0.911 \n 9 15      8   0.438 \n10 30      8   0.754 \n11 15      8.5 0.272 \n12 30      8.5 0.510 \n13 15      9   0.145 \n14 30      9   0.262 \n15 15      9.5 0.0658\n16 30      9.5 0.0972\n17 15     10   0.025 \n18 30     10   0.025 \n```\n:::\n:::\n\n##  then make the plot:\n\n::: {.cell}\n\n```{.r .cell-code}\ng  <-  ggplot(d, aes(x = mean, y = power, colour = n)) +\n  geom_point() + geom_line() +\n  geom_hline(yintercept = 1, linetype = \"dashed\") +\n  geom_vline(xintercept = 10, linetype = \"dotted\")\n```\n:::\n\n## The power curves\n\n::: {.cell}\n\n```{.r .cell-code}\ng\n```\n\n::: {.cell-output-display}\n![](inference_2_R_slides_files/figure-beamer/inference-2-R-22-1.pdf)\n:::\n:::\n\n## Comments\n- When `mean=10`, that is, the true mean equals the null mean, $H_0$ is\nactually true, and the probability of rejecting it then is $\\alpha = 0.05$.\n- As the null gets more wrong (mean decreases), it becomes easier to\ncorrectly reject it.\n- The blue power curve is above the red one for any mean < 10, meaning\nthat no matter how wrong $H_0$ is, you always have a greater chance of\ncorrectly rejecting it with a larger sample size.\n- Previously, we had $H_0 : \\mu = 10$ and a true $\\mu = 8$, so a mean of 8\nproduces power 0.42 and 0.80 as shown on the graph.\n- With $n = 30$, a true mean that is less than about 7\nis almost certain to be correctly rejected. (With $n = 15$, the\ntrue mean needs to be less than 6.)\n\n\n## Two-sample power\n\n::: {.cell}\n\n:::\n\n\n- For kids learning to read, had sample sizes of 22 (approx) in each group\n- and these group SDs:\n\n::: {.cell}\n\n```{.r .cell-code}\nkids %>% group_by(group) %>% \n  summarize(n=n(), s=sd(score))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 3\n  group     n     s\n  <chr> <int> <dbl>\n1 c        23  17.1\n2 t        21  11.0\n```\n:::\n:::\n\n## Setting up\n\n- suppose a 5-point improvement in reading score was considered important (on this scale)\n- in a 2-sample test, null (difference of) mean is zero, so `delta` is true difference in means\n- what is power for these sample sizes, and what sample size would be needed to get power up to 0.80?\n- SD in both groups has to be same in `power.t.test`, so take as 14.\n\n## Calculating power for sample size 22 (per group) \n\n::: {.cell}\n\n```{.r .cell-code}\npower.t.test(n=22, delta=5, sd=14, type=\"two.sample\", \n             alternative=\"one.sided\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n     Two-sample t test power calculation \n\n              n = 22\n          delta = 5\n             sd = 14\n      sig.level = 0.05\n          power = 0.3158199\n    alternative = one.sided\n\nNOTE: n is number in *each* group\n```\n:::\n:::\n\n## sample size for power 0.8 \n\n::: {.cell}\n\n```{.r .cell-code}\npower.t.test(power=0.80, delta=5, sd=14, type=\"two.sample\", \n             alternative=\"one.sided\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n     Two-sample t test power calculation \n\n              n = 97.62598\n          delta = 5\n             sd = 14\n      sig.level = 0.05\n          power = 0.8\n    alternative = one.sided\n\nNOTE: n is number in *each* group\n```\n:::\n:::\n\n## Comments\n\n- The power for the sample sizes we have is very small (to detect a 5-point increase).\n- To get power 0.80, we need 98 kids in *each* group!\n\n",
    "supporting": [
      "inference_2_R_slides_files/figure-beamer"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}