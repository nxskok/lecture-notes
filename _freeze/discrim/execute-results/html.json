{
  "hash": "52e5ce0f42ba63f8cc2abfa25827e752",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Discriminant Analysis\"\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n\n\n## Discriminant analysis\n\n-   ANOVA and MANOVA: predict a (counted/measured) response from group\n    membership.\n\n-   Discriminant analysis: predict group membership based on\n    counted/measured variables.\n\n-   Covers same ground as logistic regression (and its variations), but\n    emphasis on classifying observed data into correct groups.\n\n-   Does so by searching for linear combination of original variables\n    that best separates data into groups (canonical variables).\n\n-   Assumption here that groups are known (for data we have). If trying\n    to \"best separate\" data into unknown groups, see *cluster analysis*.\n\n## Packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS, exclude = \"select\")\nlibrary(tidyverse)\nlibrary(ggrepel)\nlibrary(ggbiplot) # this loads plyr (different from dplyr)\nlibrary(MVTests) # for Box M test\nlibrary(conflicted)\nconflict_prefer(\"arrange\", \"dplyr\")\nconflict_prefer(\"summarize\", \"dplyr\")\nconflict_prefer(\"select\", \"dplyr\")\nconflict_prefer(\"filter\", \"dplyr\")\nconflict_prefer(\"mutate\", \"dplyr\")\nconflicts_prefer(dplyr::count) \n```\n:::\n\n\n\n\n-   `ggrepel` allows labelling points on a plot so they don't overwrite\n    each other.\n-   `ggbiplot` uses `plyr` rather than `dplyr`, which has functions by\n    similar names.\n\n## About `select`\n\n-   Both `dplyr` (in `tidyverse`) and `MASS` have a function called\n    `select`, and *they do different things*.\n\n-   How do you know which `select` is going to get called?\n\n-   With `library`, the one loaded *last* is visible, and others are\n    not.\n\n-   Thus we can access the `select` in `dplyr` but not the one in\n    `MASS`. If we wanted that one, we'd have to say `MASS::select`.\n\n-   Better: load `conflicted` package. Any time you load two packages\n    containing functions with same name, you get error and have to\n    choose between them.\n\n## Example 1: seed yields and weights\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_url <- \"http://ritsokiguess.site/datafiles/manova1.txt\"\nhilo <- read_delim(my_url, \" \")\ng <- ggplot(hilo, aes(x = yield, y = weight,\n  colour = fertilizer)) + geom_point(size = 4)\n```\n:::\n\n\n\n\n::: columns\n::: {.column width=\"40%\"}\nRecall data from MANOVA: needed a multivariate analysis to find\ndifference in seed yield and weight based on whether they were high or\nlow fertilizer.\n:::\n\n::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/unnamed-chunk-1-1.png){width=960}\n:::\n:::\n\n\n\n:::\n:::\n\n## Basic discriminant analysis\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhilo.1 <- lda(fertilizer ~ yield + weight, data = hilo)\n```\n:::\n\n\n\n\n-   Uses `lda` from package MASS.\n\n-   \"Predicting\" group membership from measured variables.\n\n## Output\n\n\\small\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhilo.1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\nlda(fertilizer ~ yield + weight, data = hilo)\n\nPrior probabilities of groups:\nhigh  low \n 0.5  0.5 \n\nGroup means:\n     yield weight\nhigh  35.0  13.25\nlow   32.5  12.00\n\nCoefficients of linear discriminants:\n              LD1\nyield  -0.7666761\nweight -1.2513563\n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Things to take from output\n\n-   Group means: high-fertilizer plants have (slightly) higher mean\n    yield and weight than low-fertilizer plants.\n\n-   \"Coefficients of linear discriminants\": \\texttt{LD1,\n    LD2,}\\ldots are scores constructed from observed variables that best\n    separate the groups.\n\n-   For any plant, get LD1 score by taking $-0.76$ times yield plus\n    $-1.25$ times weight, add up, standardize.\n\n-   the LD1 coefficients are like slopes:\n\n    -   if yield higher, LD1 score for a plant lower\n    -   if weight higher, LD1 score for a plant lower\n\n-   High-fertilizer plants have higher yield and weight, thus low\n    (negative) LD1 score. Low-fertilizer plants have low yield and\n    weight, thus high (positive) LD1 score.\n\n-   One LD1 score for each observation. Plot with actual groups.\n\n## How many linear discriminants?\n\n-   Smaller of these:\n\n    -   Number of variables\n\n    -   Number of groups *minus 1*\n\n-   Seed yield and weight: 2 variables, 2 groups, $\\min(2,2-1)=1$.\n\n## Getting LD scores\n\nFeed output from LDA into `predict`:\n\n\\scriptsize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- predict(hilo.1)\np\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$class\n[1] low  low  low  low  high high high high\nLevels: high low\n\n$posterior\n          high          low\n1 2.108619e-05 9.999789e-01\n2 1.245320e-03 9.987547e-01\n3 2.315016e-02 9.768498e-01\n4 4.579036e-02 9.542096e-01\n5 9.817958e-01 1.820422e-02\n6 9.998195e-01 1.804941e-04\n7 9.089278e-01 9.107216e-02\n8 9.999109e-01 8.914534e-05\n\n$x\n         LD1\n1  3.0931414\n2  1.9210963\n3  1.0751090\n4  0.8724245\n5 -1.1456079\n6 -2.4762756\n7 -0.6609276\n8 -2.6789600\n```\n\n\n:::\n\n```{.r .cell-code}\nhilo.2 <- cbind(hilo, p)\nhilo.2\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"fertilizer\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"yield\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"weight\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"class\"],\"name\":[4],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"posterior.high\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.low\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"LD1\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"low\",\"2\":\"34\",\"3\":\"10\",\"4\":\"low\",\"5\":\"2.108619e-05\",\"6\":\"9.999789e-01\",\"7\":\"3.0931414\",\"_rn_\":\"1\"},{\"1\":\"low\",\"2\":\"29\",\"3\":\"14\",\"4\":\"low\",\"5\":\"1.245320e-03\",\"6\":\"9.987547e-01\",\"7\":\"1.9210963\",\"_rn_\":\"2\"},{\"1\":\"low\",\"2\":\"35\",\"3\":\"11\",\"4\":\"low\",\"5\":\"2.315016e-02\",\"6\":\"9.768498e-01\",\"7\":\"1.0751090\",\"_rn_\":\"3\"},{\"1\":\"low\",\"2\":\"32\",\"3\":\"13\",\"4\":\"low\",\"5\":\"4.579036e-02\",\"6\":\"9.542096e-01\",\"7\":\"0.8724245\",\"_rn_\":\"4\"},{\"1\":\"high\",\"2\":\"33\",\"3\":\"14\",\"4\":\"high\",\"5\":\"9.817958e-01\",\"6\":\"1.820422e-02\",\"7\":\"-1.1456079\",\"_rn_\":\"5\"},{\"1\":\"high\",\"2\":\"38\",\"3\":\"12\",\"4\":\"high\",\"5\":\"9.998195e-01\",\"6\":\"1.804941e-04\",\"7\":\"-2.4762756\",\"_rn_\":\"6\"},{\"1\":\"high\",\"2\":\"34\",\"3\":\"13\",\"4\":\"high\",\"5\":\"9.089278e-01\",\"6\":\"9.107216e-02\",\"7\":\"-0.6609276\",\"_rn_\":\"7\"},{\"1\":\"high\",\"2\":\"35\",\"3\":\"14\",\"4\":\"high\",\"5\":\"9.999109e-01\",\"6\":\"8.914534e-05\",\"7\":\"-2.6789600\",\"_rn_\":\"8\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n## LD1 scores in order\n\nMost positive LD1 score is most obviously low fertilizer, most negative\nis most obviously high:\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhilo.2 %>% select(fertilizer, yield, weight, LD1) %>% \n  arrange(desc(LD1))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"fertilizer\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"yield\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"weight\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"LD1\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"low\",\"2\":\"34\",\"3\":\"10\",\"4\":\"3.0931414\",\"_rn_\":\"1\"},{\"1\":\"low\",\"2\":\"29\",\"3\":\"14\",\"4\":\"1.9210963\",\"_rn_\":\"2\"},{\"1\":\"low\",\"2\":\"35\",\"3\":\"11\",\"4\":\"1.0751090\",\"_rn_\":\"3\"},{\"1\":\"low\",\"2\":\"32\",\"3\":\"13\",\"4\":\"0.8724245\",\"_rn_\":\"4\"},{\"1\":\"high\",\"2\":\"34\",\"3\":\"13\",\"4\":\"-0.6609276\",\"_rn_\":\"7\"},{\"1\":\"high\",\"2\":\"33\",\"3\":\"14\",\"4\":\"-1.1456079\",\"_rn_\":\"5\"},{\"1\":\"high\",\"2\":\"38\",\"3\":\"12\",\"4\":\"-2.4762756\",\"_rn_\":\"6\"},{\"1\":\"high\",\"2\":\"35\",\"3\":\"14\",\"4\":\"-2.6789600\",\"_rn_\":\"8\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\nHigh fertilizer have yield and weight high, negative LD1 scores.\n\n## Plotting LD1 scores\n\nWith one LD score, plot against (true) groups, eg. boxplot:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(hilo.2, aes(x = fertilizer, y = LD1)) + geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/bDiscrim-8-1.png){width=960}\n:::\n:::\n\n\n\n\n## What else is in `hilo.2`?\n\n-   `class`: predicted fertilizer level (based on values of `yield` and\n    `weight`).\n\n-   `posterior`: predicted probability of being low or high fertilizer\n    given `yield` and `weight`.\n\n-   `LD1`: scores for (each) linear discriminant (here is only LD1) on\n    each observation.\n\n## Predictions and predicted groups\n\n\\ldots based on `yield` and `weight`:\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhilo.2 %>% select(yield, weight, fertilizer, class)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"yield\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"weight\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"fertilizer\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"class\"],\"name\":[4],\"type\":[\"fct\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"34\",\"2\":\"10\",\"3\":\"low\",\"4\":\"low\",\"_rn_\":\"1\"},{\"1\":\"29\",\"2\":\"14\",\"3\":\"low\",\"4\":\"low\",\"_rn_\":\"2\"},{\"1\":\"35\",\"2\":\"11\",\"3\":\"low\",\"4\":\"low\",\"_rn_\":\"3\"},{\"1\":\"32\",\"2\":\"13\",\"3\":\"low\",\"4\":\"low\",\"_rn_\":\"4\"},{\"1\":\"33\",\"2\":\"14\",\"3\":\"high\",\"4\":\"high\",\"_rn_\":\"5\"},{\"1\":\"38\",\"2\":\"12\",\"3\":\"high\",\"4\":\"high\",\"_rn_\":\"6\"},{\"1\":\"34\",\"2\":\"13\",\"3\":\"high\",\"4\":\"high\",\"_rn_\":\"7\"},{\"1\":\"35\",\"2\":\"14\",\"3\":\"high\",\"4\":\"high\",\"_rn_\":\"8\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Count up correct and incorrect classification\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwith(hilo.2, table(obs = fertilizer, pred = class))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      pred\nobs    high low\n  high    4   0\n  low     0   4\n```\n\n\n:::\n:::\n\n\n\n\n-   Each predicted fertilizer level is exactly same as observed one\n    (perfect prediction).\n\n-   Table shows no errors: all values on top-left to bottom-right\n    diagonal.\n\n## Posterior probabilities\n\n\\footnotesize\n\nshow how clear-cut the classification decisions were:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhilo.2 %>% \n  mutate(across(starts_with(\"posterior\"), \\(p) round(p, 4))) %>% \n  select(-LD1)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"fertilizer\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"yield\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"weight\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"class\"],\"name\":[4],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"posterior.high\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.low\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"low\",\"2\":\"34\",\"3\":\"10\",\"4\":\"low\",\"5\":\"0.0000\",\"6\":\"1.0000\",\"_rn_\":\"1\"},{\"1\":\"low\",\"2\":\"29\",\"3\":\"14\",\"4\":\"low\",\"5\":\"0.0012\",\"6\":\"0.9988\",\"_rn_\":\"2\"},{\"1\":\"low\",\"2\":\"35\",\"3\":\"11\",\"4\":\"low\",\"5\":\"0.0232\",\"6\":\"0.9768\",\"_rn_\":\"3\"},{\"1\":\"low\",\"2\":\"32\",\"3\":\"13\",\"4\":\"low\",\"5\":\"0.0458\",\"6\":\"0.9542\",\"_rn_\":\"4\"},{\"1\":\"high\",\"2\":\"33\",\"3\":\"14\",\"4\":\"high\",\"5\":\"0.9818\",\"6\":\"0.0182\",\"_rn_\":\"5\"},{\"1\":\"high\",\"2\":\"38\",\"3\":\"12\",\"4\":\"high\",\"5\":\"0.9998\",\"6\":\"0.0002\",\"_rn_\":\"6\"},{\"1\":\"high\",\"2\":\"34\",\"3\":\"13\",\"4\":\"high\",\"5\":\"0.9089\",\"6\":\"0.0911\",\"_rn_\":\"7\"},{\"1\":\"high\",\"2\":\"35\",\"3\":\"14\",\"4\":\"high\",\"5\":\"0.9999\",\"6\":\"0.0001\",\"_rn_\":\"8\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\nOnly obs. 7 has any doubt: `yield` low for a high-fertilizer, but high\n`weight` makes up for it.\n\n\\normalsize\n\n## Example 2: the peanuts\n\n\\scriptsize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_url <- \"http://ritsokiguess.site/datafiles/peanuts.txt\"\npeanuts <- read_delim(my_url, \" \")\npeanuts\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"obs\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"location\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"variety\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"y\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"smk\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"w\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"1\",\"3\":\"5\",\"4\":\"195.3\",\"5\":\"153.1\",\"6\":\"51.4\"},{\"1\":\"2\",\"2\":\"1\",\"3\":\"5\",\"4\":\"194.3\",\"5\":\"167.7\",\"6\":\"53.7\"},{\"1\":\"3\",\"2\":\"2\",\"3\":\"5\",\"4\":\"189.7\",\"5\":\"139.5\",\"6\":\"55.5\"},{\"1\":\"4\",\"2\":\"2\",\"3\":\"5\",\"4\":\"180.4\",\"5\":\"121.1\",\"6\":\"44.4\"},{\"1\":\"5\",\"2\":\"1\",\"3\":\"6\",\"4\":\"203.0\",\"5\":\"156.8\",\"6\":\"49.8\"},{\"1\":\"6\",\"2\":\"1\",\"3\":\"6\",\"4\":\"195.9\",\"5\":\"166.0\",\"6\":\"45.8\"},{\"1\":\"7\",\"2\":\"2\",\"3\":\"6\",\"4\":\"202.7\",\"5\":\"166.1\",\"6\":\"60.4\"},{\"1\":\"8\",\"2\":\"2\",\"3\":\"6\",\"4\":\"197.6\",\"5\":\"161.8\",\"6\":\"54.1\"},{\"1\":\"9\",\"2\":\"1\",\"3\":\"8\",\"4\":\"193.5\",\"5\":\"164.5\",\"6\":\"57.8\"},{\"1\":\"10\",\"2\":\"1\",\"3\":\"8\",\"4\":\"187.0\",\"5\":\"165.1\",\"6\":\"58.6\"},{\"1\":\"11\",\"2\":\"2\",\"3\":\"8\",\"4\":\"201.5\",\"5\":\"166.8\",\"6\":\"65.0\"},{\"1\":\"12\",\"2\":\"2\",\"3\":\"8\",\"4\":\"200.0\",\"5\":\"173.8\",\"6\":\"67.2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n-   Recall: `location` and `variety` both significant in MANOVA. Make\n    combo of them (over):\n\n## Location-variety combos\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeanuts %>%\n   unite(combo, c(variety, location)) -> peanuts.combo\npeanuts.combo\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"obs\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"combo\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"y\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"smk\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"w\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"5_1\",\"3\":\"195.3\",\"4\":\"153.1\",\"5\":\"51.4\"},{\"1\":\"2\",\"2\":\"5_1\",\"3\":\"194.3\",\"4\":\"167.7\",\"5\":\"53.7\"},{\"1\":\"3\",\"2\":\"5_2\",\"3\":\"189.7\",\"4\":\"139.5\",\"5\":\"55.5\"},{\"1\":\"4\",\"2\":\"5_2\",\"3\":\"180.4\",\"4\":\"121.1\",\"5\":\"44.4\"},{\"1\":\"5\",\"2\":\"6_1\",\"3\":\"203.0\",\"4\":\"156.8\",\"5\":\"49.8\"},{\"1\":\"6\",\"2\":\"6_1\",\"3\":\"195.9\",\"4\":\"166.0\",\"5\":\"45.8\"},{\"1\":\"7\",\"2\":\"6_2\",\"3\":\"202.7\",\"4\":\"166.1\",\"5\":\"60.4\"},{\"1\":\"8\",\"2\":\"6_2\",\"3\":\"197.6\",\"4\":\"161.8\",\"5\":\"54.1\"},{\"1\":\"9\",\"2\":\"8_1\",\"3\":\"193.5\",\"4\":\"164.5\",\"5\":\"57.8\"},{\"1\":\"10\",\"2\":\"8_1\",\"3\":\"187.0\",\"4\":\"165.1\",\"5\":\"58.6\"},{\"1\":\"11\",\"2\":\"8_2\",\"3\":\"201.5\",\"4\":\"166.8\",\"5\":\"65.0\"},{\"1\":\"12\",\"2\":\"8_2\",\"3\":\"200.0\",\"4\":\"173.8\",\"5\":\"67.2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Discriminant analysis\n\n\\tiny\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# peanuts.1 <- lda(str_c(location, variety, sep = \"_\") ~ y + smk + w, data = peanuts)\npeanuts.1 <- lda(combo ~ y + smk + w, data = peanuts.combo)\npeanuts.1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\nlda(combo ~ y + smk + w, data = peanuts.combo)\n\nPrior probabilities of groups:\n      5_1       5_2       6_1       6_2       8_1       8_2 \n0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 \n\nGroup means:\n         y    smk     w\n5_1 194.80 160.40 52.55\n5_2 185.05 130.30 49.95\n6_1 199.45 161.40 47.80\n6_2 200.15 163.95 57.25\n8_1 190.25 164.80 58.20\n8_2 200.75 170.30 66.10\n\nCoefficients of linear discriminants:\n           LD1         LD2         LD3\ny    0.4027356  0.02967881  0.18839237\nsmk  0.1727459 -0.06794271 -0.09386294\nw   -0.5792456 -0.16300221  0.07341123\n\nProportion of trace:\n   LD1    LD2    LD3 \n0.8424 0.1317 0.0258 \n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Comments\n\n-   Now 3 LDs (3 variables, 6 groups, $\\min(3,6-1)=3$).\n\n-   Relationship of LDs to original variables. Look for coeffs far from\n    zero:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeanuts.1$scaling\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           LD1         LD2         LD3\ny    0.4027356  0.02967881  0.18839237\nsmk  0.1727459 -0.06794271 -0.09386294\nw   -0.5792456 -0.16300221  0.07341123\n```\n\n\n:::\n:::\n\n\n\n\n-   high `LD1` mainly high `y` or low `w`.\n\n-   high `LD2` mainly low `w`.\n\n-   Proportion of trace values show relative importance of LDs: `LD1`\n    much more important than `LD2`; `LD3` worthless.\n\n## The predictions and misclassification\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- predict(peanuts.1)\npeanuts.2 <- cbind(peanuts.combo, p)\npeanuts.2\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"obs\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"combo\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"y\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"smk\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"w\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"class\"],\"name\":[6],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"posterior.5_1\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.5_2\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.6_1\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.6_2\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.8_1\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.8_2\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"x.LD1\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"x.LD2\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"x.LD3\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"5_1\",\"3\":\"195.3\",\"4\":\"153.1\",\"5\":\"51.4\",\"6\":\"5_1\",\"7\":\"6.862288e-01\",\"8\":\"1.825787e-12\",\"9\":\"1.626712e-06\",\"10\":\"3.137397e-01\",\"11\":\"1.789618e-05\",\"12\":\"1.198440e-05\",\"13\":\"1.417354\",\"14\":\"1.01233393\",\"15\":\"0.26467918\",\"_rn_\":\"1\"},{\"1\":\"2\",\"2\":\"5_1\",\"3\":\"194.3\",\"4\":\"167.7\",\"5\":\"53.7\",\"6\":\"5_1\",\"7\":\"7.269338e-01\",\"8\":\"7.555850e-17\",\"9\":\"1.265614e-05\",\"10\":\"2.730344e-01\",\"11\":\"1.351022e-05\",\"12\":\"5.606435e-06\",\"13\":\"2.204444\",\"14\":\"-0.38421359\",\"15\":\"-1.12526629\",\"_rn_\":\"2\"},{\"1\":\"3\",\"2\":\"5_2\",\"3\":\"189.7\",\"4\":\"139.5\",\"5\":\"55.5\",\"6\":\"5_2\",\"7\":\"1.624097e-12\",\"8\":\"9.996353e-01\",\"9\":\"1.501005e-32\",\"10\":\"8.539384e-13\",\"11\":\"3.555819e-04\",\"12\":\"9.130935e-06\",\"13\":\"-5.562217\",\"14\":\"1.10184441\",\"15\":\"0.78720394\",\"_rn_\":\"3\"},{\"1\":\"4\",\"2\":\"5_2\",\"3\":\"180.4\",\"4\":\"121.1\",\"5\":\"44.4\",\"6\":\"5_2\",\"7\":\"1.702156e-16\",\"8\":\"1.000000e+00\",\"9\":\"1.070250e-36\",\"10\":\"3.502685e-18\",\"11\":\"1.507494e-08\",\"12\":\"1.207900e-12\",\"13\":\"-6.056558\",\"14\":\"3.88530191\",\"15\":\"-0.05263163\",\"_rn_\":\"4\"},{\"1\":\"5\",\"2\":\"6_1\",\"3\":\"203.0\",\"4\":\"156.8\",\"5\":\"49.8\",\"6\":\"6_1\",\"7\":\"4.262552e-05\",\"8\":\"1.500083e-31\",\"9\":\"9.999036e-01\",\"10\":\"5.379795e-05\",\"11\":\"5.404834e-19\",\"12\":\"3.274483e-17\",\"13\":\"6.084370\",\"14\":\"1.25027629\",\"15\":\"1.25054957\",\"_rn_\":\"5\"},{\"1\":\"6\",\"2\":\"6_1\",\"3\":\"195.9\",\"4\":\"166.0\",\"5\":\"45.8\",\"6\":\"6_1\",\"7\":\"9.681355e-07\",\"8\":\"1.071193e-37\",\"9\":\"9.999989e-01\",\"10\":\"1.176475e-07\",\"11\":\"1.407963e-21\",\"12\":\"1.260338e-21\",\"13\":\"7.131192\",\"14\":\"1.06649258\",\"15\":\"-1.24422021\",\"_rn_\":\"6\"},{\"1\":\"7\",\"2\":\"6_2\",\"3\":\"202.7\",\"4\":\"166.1\",\"5\":\"60.4\",\"6\":\"6_2\",\"7\":\"1.324922e-01\",\"8\":\"5.989065e-15\",\"9\":\"7.932019e-08\",\"10\":\"8.655891e-01\",\"11\":\"2.872010e-05\",\"12\":\"1.889878e-03\",\"13\":\"1.430084\",\"14\":\"-1.11831802\",\"15\":\"1.09926555\",\"_rn_\":\"7\"},{\"1\":\"8\",\"2\":\"6_2\",\"3\":\"197.6\",\"4\":\"161.8\",\"5\":\"54.1\",\"6\":\"5_1\",\"7\":\"5.286987e-01\",\"8\":\"2.037992e-16\",\"9\":\"3.255237e-05\",\"10\":\"4.712635e-01\",\"11\":\"1.387366e-06\",\"12\":\"3.934555e-06\",\"13\":\"2.282572\",\"14\":\"0.04938762\",\"15\":\"0.07958437\",\"_rn_\":\"8\"},{\"1\":\"9\",\"2\":\"8_1\",\"3\":\"193.5\",\"4\":\"164.5\",\"5\":\"57.8\",\"6\":\"8_1\",\"7\":\"2.298649e-02\",\"8\":\"6.924748e-08\",\"9\":\"5.529930e-14\",\"10\":\"1.764211e-02\",\"11\":\"7.502924e-01\",\"12\":\"2.090789e-01\",\"13\":\"-1.045438\",\"14\":\"-0.85884902\",\"15\":\"-0.67463274\",\"_rn_\":\"9\"},{\"1\":\"10\",\"2\":\"8_1\",\"3\":\"187.0\",\"4\":\"165.1\",\"5\":\"58.6\",\"6\":\"8_1\",\"7\":\"1.572134e-08\",\"8\":\"5.773681e-05\",\"9\":\"1.026123e-26\",\"10\":\"4.128139e-09\",\"11\":\"9.937398e-01\",\"12\":\"6.202449e-03\",\"13\":\"-4.022969\",\"14\":\"-1.22292871\",\"15\":\"-1.89677191\",\"_rn_\":\"10\"},{\"1\":\"11\",\"2\":\"8_2\",\"3\":\"201.5\",\"4\":\"166.8\",\"5\":\"65.0\",\"6\":\"8_2\",\"7\":\"8.160707e-05\",\"8\":\"6.481495e-09\",\"9\":\"1.219898e-17\",\"10\":\"9.872502e-04\",\"11\":\"2.708552e-02\",\"12\":\"9.718456e-01\",\"13\":\"-1.596806\",\"14\":\"-1.95130266\",\"15\":\"1.14518230\",\"_rn_\":\"11\"},{\"1\":\"12\",\"2\":\"8_2\",\"3\":\"200.0\",\"4\":\"173.8\",\"5\":\"67.2\",\"6\":\"8_2\",\"7\":\"1.509768e-06\",\"8\":\"1.557142e-09\",\"9\":\"3.094904e-21\",\"10\":\"1.688982e-05\",\"11\":\"5.873968e-02\",\"12\":\"9.412419e-01\",\"13\":\"-2.266028\",\"14\":\"-2.83002474\",\"15\":\"0.36705787\",\"_rn_\":\"12\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nwith(peanuts.2, table(obs = combo, pred = class))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     pred\nobs   5_1 5_2 6_1 6_2 8_1 8_2\n  5_1   2   0   0   0   0   0\n  5_2   0   2   0   0   0   0\n  6_1   0   0   2   0   0   0\n  6_2   1   0   0   1   0   0\n  8_1   0   0   0   0   2   0\n  8_2   0   0   0   0   0   2\n```\n\n\n:::\n:::\n\n\n\n\nActually classified very well. Only one `6_2` classified as a `5_1`,\nrest all correct.\n\n## Posterior probabilities\n\n\\scriptsize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeanuts.2 %>% \n  mutate(across(starts_with(\"posterior\"), \\(p) round(p, 2))) %>% \n  select(combo,  class, starts_with(\"posterior\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"combo\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"class\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"posterior.5_1\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.5_2\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.6_1\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.6_2\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.8_1\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.8_2\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"5_1\",\"2\":\"5_1\",\"3\":\"0.69\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0.31\",\"7\":\"0.00\",\"8\":\"0.00\",\"_rn_\":\"1\"},{\"1\":\"5_1\",\"2\":\"5_1\",\"3\":\"0.73\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0.27\",\"7\":\"0.00\",\"8\":\"0.00\",\"_rn_\":\"2\"},{\"1\":\"5_2\",\"2\":\"5_2\",\"3\":\"0.00\",\"4\":\"1\",\"5\":\"0\",\"6\":\"0.00\",\"7\":\"0.00\",\"8\":\"0.00\",\"_rn_\":\"3\"},{\"1\":\"5_2\",\"2\":\"5_2\",\"3\":\"0.00\",\"4\":\"1\",\"5\":\"0\",\"6\":\"0.00\",\"7\":\"0.00\",\"8\":\"0.00\",\"_rn_\":\"4\"},{\"1\":\"6_1\",\"2\":\"6_1\",\"3\":\"0.00\",\"4\":\"0\",\"5\":\"1\",\"6\":\"0.00\",\"7\":\"0.00\",\"8\":\"0.00\",\"_rn_\":\"5\"},{\"1\":\"6_1\",\"2\":\"6_1\",\"3\":\"0.00\",\"4\":\"0\",\"5\":\"1\",\"6\":\"0.00\",\"7\":\"0.00\",\"8\":\"0.00\",\"_rn_\":\"6\"},{\"1\":\"6_2\",\"2\":\"6_2\",\"3\":\"0.13\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0.87\",\"7\":\"0.00\",\"8\":\"0.00\",\"_rn_\":\"7\"},{\"1\":\"6_2\",\"2\":\"5_1\",\"3\":\"0.53\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0.47\",\"7\":\"0.00\",\"8\":\"0.00\",\"_rn_\":\"8\"},{\"1\":\"8_1\",\"2\":\"8_1\",\"3\":\"0.02\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0.02\",\"7\":\"0.75\",\"8\":\"0.21\",\"_rn_\":\"9\"},{\"1\":\"8_1\",\"2\":\"8_1\",\"3\":\"0.00\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0.00\",\"7\":\"0.99\",\"8\":\"0.01\",\"_rn_\":\"10\"},{\"1\":\"8_2\",\"2\":\"8_2\",\"3\":\"0.00\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0.00\",\"7\":\"0.03\",\"8\":\"0.97\",\"_rn_\":\"11\"},{\"1\":\"8_2\",\"2\":\"8_2\",\"3\":\"0.00\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0.00\",\"7\":\"0.06\",\"8\":\"0.94\",\"_rn_\":\"12\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\small\n\n*Some* doubt about which combo each plant belongs in, but not too much.\nThe one misclassified plant was a close call.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeanuts.2 %>% count(combo, class) %>% pivot_wider(names_from = \"class\" , values_from = n, values_fill = 0)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"combo\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"5_1\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"5_2\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"6_1\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"6_2\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"8_1\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"8_2\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"5_1\",\"2\":\"2\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\"},{\"1\":\"5_2\",\"2\":\"0\",\"3\":\"2\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\"},{\"1\":\"6_1\",\"2\":\"0\",\"3\":\"0\",\"4\":\"2\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\"},{\"1\":\"6_2\",\"2\":\"1\",\"3\":\"0\",\"4\":\"0\",\"5\":\"1\",\"6\":\"0\",\"7\":\"0\"},{\"1\":\"8_1\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"2\",\"7\":\"0\"},{\"1\":\"8_2\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\n\\normalsize\n\n## Discriminant scores, again\n\n-   How are discriminant scores related to original variables?\n\n-   Construct data frame with original data and discriminant scores side\n    by side:\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeanuts.1$scaling\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           LD1         LD2         LD3\ny    0.4027356  0.02967881  0.18839237\nsmk  0.1727459 -0.06794271 -0.09386294\nw   -0.5792456 -0.16300221  0.07341123\n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n-   LD1 positive if `y` large and/or `w` small.\n\n-   LD2 positive if `w` small.\n\n## Discriminant scores for data\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeanuts.2 %>% select(y, w, starts_with(\"x\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"y\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"w\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"x.LD1\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"x.LD2\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"x.LD3\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"195.3\",\"2\":\"51.4\",\"3\":\"1.417354\",\"4\":\"1.01233393\",\"5\":\"0.26467918\",\"_rn_\":\"1\"},{\"1\":\"194.3\",\"2\":\"53.7\",\"3\":\"2.204444\",\"4\":\"-0.38421359\",\"5\":\"-1.12526629\",\"_rn_\":\"2\"},{\"1\":\"189.7\",\"2\":\"55.5\",\"3\":\"-5.562217\",\"4\":\"1.10184441\",\"5\":\"0.78720394\",\"_rn_\":\"3\"},{\"1\":\"180.4\",\"2\":\"44.4\",\"3\":\"-6.056558\",\"4\":\"3.88530191\",\"5\":\"-0.05263163\",\"_rn_\":\"4\"},{\"1\":\"203.0\",\"2\":\"49.8\",\"3\":\"6.084370\",\"4\":\"1.25027629\",\"5\":\"1.25054957\",\"_rn_\":\"5\"},{\"1\":\"195.9\",\"2\":\"45.8\",\"3\":\"7.131192\",\"4\":\"1.06649258\",\"5\":\"-1.24422021\",\"_rn_\":\"6\"},{\"1\":\"202.7\",\"2\":\"60.4\",\"3\":\"1.430084\",\"4\":\"-1.11831802\",\"5\":\"1.09926555\",\"_rn_\":\"7\"},{\"1\":\"197.6\",\"2\":\"54.1\",\"3\":\"2.282572\",\"4\":\"0.04938762\",\"5\":\"0.07958437\",\"_rn_\":\"8\"},{\"1\":\"193.5\",\"2\":\"57.8\",\"3\":\"-1.045438\",\"4\":\"-0.85884902\",\"5\":\"-0.67463274\",\"_rn_\":\"9\"},{\"1\":\"187.0\",\"2\":\"58.6\",\"3\":\"-4.022969\",\"4\":\"-1.22292871\",\"5\":\"-1.89677191\",\"_rn_\":\"10\"},{\"1\":\"201.5\",\"2\":\"65.0\",\"3\":\"-1.596806\",\"4\":\"-1.95130266\",\"5\":\"1.14518230\",\"_rn_\":\"11\"},{\"1\":\"200.0\",\"2\":\"67.2\",\"3\":\"-2.266028\",\"4\":\"-2.83002474\",\"5\":\"0.36705787\",\"_rn_\":\"12\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n-   Obs. 5 and 6 have most positive `LD1`: large `y`, small `w`.\n\n-   Obs. 4 has most positive `LD2`: small `w`.\n\n\\normalsize\n\n## Plot LD1 vs. LD2, labelling by combo\n\n\\small\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggplot(peanuts.2, aes(x = x.LD1, y = x.LD2, colour = combo, \n                    label = combo)) + geom_point() +\n  geom_text_repel() + guides(colour = \"none\")\ng\n```\n\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/bDiscrim-24-1.png){width=960}\n:::\n:::\n\n\n\n\n\\normalsize\n\n## \"Bi-plot\" from `ggbiplot`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggbiplot(peanuts.1, groups = factor(peanuts.combo$combo))\n```\n\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/bDiscrim-25-1.png){width=960}\n:::\n:::\n\n\n\n\n## Installing `ggbiplot`\n\n-   `ggbiplot` not on CRAN, so usual `install.packages` will not work.\n\n-   Install package `devtools` first (once):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"devtools\")\n```\n:::\n\n\n\n\n-   Then install `ggbiplot` (once):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(devtools)\ninstall_github(\"vqv/ggbiplot\")\n```\n:::\n\n\n\n\n## Cross-validation\n\n-   So far, have predicted group membership from same data used to form\n    the groups --- dishonest!\n\n-   Better: *cross-validation*: form groups from all observations\n    *except one*, then predict group membership for that left-out\n    observation.\n\n-   No longer cheating!\n\n-   Illustrate with peanuts data again.\n\n## Misclassifications\n\n-   Fitting and prediction all in one go:\n\n\\small\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- lda(combo ~ y + smk + w,\n  data = peanuts.combo, CV = TRUE)\np\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$class\n [1] 6_2 6_2 8_1 5_2 6_1 6_1 6_2 5_1 8_2 5_2 8_2 8_2\nLevels: 5_1 5_2 6_1 6_2 8_1 8_2\n\n$posterior\n            5_1          5_2           6_1          6_2          8_1\n1  1.615389e-01 1.434120e-11  1.534102e-05 8.379976e-01 2.513881e-04\n2  2.002430e-01 2.348881e-17  2.716638e-04 7.992050e-01 1.983409e-04\n3  3.061292e-07 1.801539e-01  3.796136e-24 9.287438e-10 8.198456e-01\n4  1.513880e-18 1.000000e+00  5.848118e-36 2.515595e-25 2.616708e-13\n5  1.936017e-01 9.311725e-28  6.689609e-01 1.374374e-01 3.201096e-13\n6  8.391064e-05 8.238363e-41  9.999157e-01 3.867752e-07 1.312799e-18\n7  3.245933e-01 4.159123e-12  1.641780e-07 6.668751e-01 5.024767e-04\n8  8.212910e-01 4.890747e-14  7.709077e-05 1.786191e-01 8.770737e-06\n9  1.695073e-11 2.831322e-22  4.210915e-82 4.164496e-14 1.207166e-14\n10 3.391832e-50 1.000000e+00 2.425913e-164 6.794240e-56 1.175980e-11\n11 5.078998e-04 2.817575e-07  1.683011e-15 3.975963e-03 8.298549e-02\n12 9.474892e-06 6.531971e-08  4.634212e-19 6.868106e-05 1.672334e-01\n            8_2\n1  1.967272e-04\n2  8.198920e-05\n3  1.404982e-07\n4  1.160099e-27\n5  3.567404e-13\n6  1.681949e-22\n7  8.028931e-03\n8  4.046379e-06\n9  1.000000e+00\n10 1.120400e-08\n11 9.125304e-01\n12 8.326884e-01\n\n$terms\ncombo ~ y + smk + w\nattr(,\"variables\")\nlist(combo, y, smk, w)\nattr(,\"factors\")\n      y smk w\ncombo 0   0 0\ny     1   0 0\nsmk   0   1 0\nw     0   0 1\nattr(,\"term.labels\")\n[1] \"y\"   \"smk\" \"w\"  \nattr(,\"order\")\n[1] 1 1 1\nattr(,\"intercept\")\n[1] 1\nattr(,\"response\")\n[1] 1\nattr(,\".Environment\")\n<environment: R_GlobalEnv>\nattr(,\"predvars\")\nlist(combo, y, smk, w)\nattr(,\"dataClasses\")\n      combo           y         smk           w \n\"character\"   \"numeric\"   \"numeric\"   \"numeric\" \n\n$call\nlda(formula = combo ~ y + smk + w, data = peanuts.combo, CV = TRUE)\n\n$xlevels\nnamed list()\n```\n\n\n:::\n\n```{.r .cell-code}\npeanuts.3 <- cbind(peanuts.combo, class = p$class, \n                   posterior = p$posterior)\nwith(peanuts.3, table(obs = combo, pred = class))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     pred\nobs   5_1 5_2 6_1 6_2 8_1 8_2\n  5_1   0   0   0   2   0   0\n  5_2   0   1   0   0   1   0\n  6_1   0   0   2   0   0   0\n  6_2   1   0   0   1   0   0\n  8_1   0   1   0   0   0   1\n  8_2   0   0   0   0   0   2\n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n-   Some more misclassification this time.\n\n## Repeat of LD plot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng\n```\n\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/graziani-1.png){width=960}\n:::\n:::\n\n\n\n\n## Posterior probabilities\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeanuts.3 %>% \n  mutate(across(starts_with(\"posterior\"), \\(p) round(p, 3))) %>% \n  select(combo, class, starts_with(\"posterior\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"combo\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"class\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"posterior.5_1\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.5_2\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.6_1\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.6_2\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.8_1\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.8_2\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"5_1\",\"2\":\"6_2\",\"3\":\"0.162\",\"4\":\"0.00\",\"5\":\"0.000\",\"6\":\"0.838\",\"7\":\"0.000\",\"8\":\"0.000\",\"_rn_\":\"1\"},{\"1\":\"5_1\",\"2\":\"6_2\",\"3\":\"0.200\",\"4\":\"0.00\",\"5\":\"0.000\",\"6\":\"0.799\",\"7\":\"0.000\",\"8\":\"0.000\",\"_rn_\":\"2\"},{\"1\":\"5_2\",\"2\":\"8_1\",\"3\":\"0.000\",\"4\":\"0.18\",\"5\":\"0.000\",\"6\":\"0.000\",\"7\":\"0.820\",\"8\":\"0.000\",\"_rn_\":\"3\"},{\"1\":\"5_2\",\"2\":\"5_2\",\"3\":\"0.000\",\"4\":\"1.00\",\"5\":\"0.000\",\"6\":\"0.000\",\"7\":\"0.000\",\"8\":\"0.000\",\"_rn_\":\"4\"},{\"1\":\"6_1\",\"2\":\"6_1\",\"3\":\"0.194\",\"4\":\"0.00\",\"5\":\"0.669\",\"6\":\"0.137\",\"7\":\"0.000\",\"8\":\"0.000\",\"_rn_\":\"5\"},{\"1\":\"6_1\",\"2\":\"6_1\",\"3\":\"0.000\",\"4\":\"0.00\",\"5\":\"1.000\",\"6\":\"0.000\",\"7\":\"0.000\",\"8\":\"0.000\",\"_rn_\":\"6\"},{\"1\":\"6_2\",\"2\":\"6_2\",\"3\":\"0.325\",\"4\":\"0.00\",\"5\":\"0.000\",\"6\":\"0.667\",\"7\":\"0.001\",\"8\":\"0.008\",\"_rn_\":\"7\"},{\"1\":\"6_2\",\"2\":\"5_1\",\"3\":\"0.821\",\"4\":\"0.00\",\"5\":\"0.000\",\"6\":\"0.179\",\"7\":\"0.000\",\"8\":\"0.000\",\"_rn_\":\"8\"},{\"1\":\"8_1\",\"2\":\"8_2\",\"3\":\"0.000\",\"4\":\"0.00\",\"5\":\"0.000\",\"6\":\"0.000\",\"7\":\"0.000\",\"8\":\"1.000\",\"_rn_\":\"9\"},{\"1\":\"8_1\",\"2\":\"5_2\",\"3\":\"0.000\",\"4\":\"1.00\",\"5\":\"0.000\",\"6\":\"0.000\",\"7\":\"0.000\",\"8\":\"0.000\",\"_rn_\":\"10\"},{\"1\":\"8_2\",\"2\":\"8_2\",\"3\":\"0.001\",\"4\":\"0.00\",\"5\":\"0.000\",\"6\":\"0.004\",\"7\":\"0.083\",\"8\":\"0.913\",\"_rn_\":\"11\"},{\"1\":\"8_2\",\"2\":\"8_2\",\"3\":\"0.000\",\"4\":\"0.00\",\"5\":\"0.000\",\"6\":\"0.000\",\"7\":\"0.167\",\"8\":\"0.833\",\"_rn_\":\"12\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Why more misclassification?\n\n-   When predicting group membership for one observation, only uses the\n    *other one* in that group.\n\n-   So if two in a pair are far apart, or if two groups overlap, great\n    potential for misclassification.\n\n-   Groups `5_1` and `6_2` overlap.\n\n-   `5_2` closest to `8_1`s looks more like an `8_1` than a `5_2` (other\n    one far away).\n\n-   `8_1`s relatively far apart and close to other things, so one\n    appears to be a `5_2` and the other an `8_2`.\n\n## Example 3: professions and leisure activities\n\n-   15 individuals from three different professions (politicians,\n    administrators and belly dancers) each participate in four different\n    leisure activities: reading, dancing, TV watching and skiing. After\n    each activity they rate it on a 0--10 scale.\n\n-   How can we best use the scores on the activities to predict a\n    person's profession?\n\n-   Or, what combination(s) of scores best separate data into profession\n    groups?\n\n## The data\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_url <- \"http://ritsokiguess.site/datafiles/profile.txt\"\nactive <- read_delim(my_url, \" \")\nactive\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"job\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"reading\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"dance\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tv\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"ski\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"bellydancer\",\"2\":\"7\",\"3\":\"10\",\"4\":\"6\",\"5\":\"5\"},{\"1\":\"bellydancer\",\"2\":\"8\",\"3\":\"9\",\"4\":\"5\",\"5\":\"7\"},{\"1\":\"bellydancer\",\"2\":\"5\",\"3\":\"10\",\"4\":\"5\",\"5\":\"8\"},{\"1\":\"bellydancer\",\"2\":\"6\",\"3\":\"10\",\"4\":\"6\",\"5\":\"8\"},{\"1\":\"bellydancer\",\"2\":\"7\",\"3\":\"8\",\"4\":\"7\",\"5\":\"9\"},{\"1\":\"politician\",\"2\":\"4\",\"3\":\"4\",\"4\":\"4\",\"5\":\"4\"},{\"1\":\"politician\",\"2\":\"6\",\"3\":\"4\",\"4\":\"5\",\"5\":\"3\"},{\"1\":\"politician\",\"2\":\"5\",\"3\":\"5\",\"4\":\"5\",\"5\":\"6\"},{\"1\":\"politician\",\"2\":\"6\",\"3\":\"6\",\"4\":\"6\",\"5\":\"7\"},{\"1\":\"politician\",\"2\":\"4\",\"3\":\"5\",\"4\":\"6\",\"5\":\"5\"},{\"1\":\"admin\",\"2\":\"3\",\"3\":\"1\",\"4\":\"1\",\"5\":\"2\"},{\"1\":\"admin\",\"2\":\"5\",\"3\":\"3\",\"4\":\"1\",\"5\":\"5\"},{\"1\":\"admin\",\"2\":\"4\",\"3\":\"2\",\"4\":\"2\",\"5\":\"5\"},{\"1\":\"admin\",\"2\":\"7\",\"3\":\"1\",\"4\":\"2\",\"5\":\"4\"},{\"1\":\"admin\",\"2\":\"6\",\"3\":\"3\",\"4\":\"3\",\"5\":\"3\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Discriminant analysis\n\n\\tiny\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nactive.1 <- lda(job ~ reading + dance + tv + ski, data = active)\nactive.1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\nlda(job ~ reading + dance + tv + ski, data = active)\n\nPrior probabilities of groups:\n      admin bellydancer  politician \n  0.3333333   0.3333333   0.3333333 \n\nGroup means:\n            reading dance  tv ski\nadmin           5.0   2.0 1.8 3.8\nbellydancer     6.6   9.4 5.8 7.4\npolitician      5.0   4.8 5.2 5.0\n\nCoefficients of linear discriminants:\n                LD1        LD2\nreading -0.01297465 -0.4748081\ndance   -0.95212396 -0.4614976\ntv      -0.47417264  1.2446327\nski      0.04153684 -0.2033122\n\nProportion of trace:\n   LD1    LD2 \n0.8917 0.1083 \n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Comments\n\n-   Two discriminants, first fair bit more important than second.\n\n-   `LD1` depends (negatively) most on `dance`, a bit on `tv`.\n\n-   `LD2` depends mostly (positively) on `tv`.\n\n## Misclassification\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- predict(active.1)\nactive.2 <- cbind(active, p)\nactive.2 %>% mutate(across(starts_with(\"posterior\"), \\(p) round(p,3)))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"job\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"reading\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"dance\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tv\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"ski\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"class\"],\"name\":[6],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"posterior.admin\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.bellydancer\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.politician\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"x.LD1\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"x.LD2\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"bellydancer\",\"2\":\"7\",\"3\":\"10\",\"4\":\"6\",\"5\":\"5\",\"6\":\"bellydancer\",\"7\":\"0.000\",\"8\":\"1.000\",\"9\":\"0.000\",\"10\":\"-5.2373137\",\"11\":\"-0.5805858\",\"_rn_\":\"1\"},{\"1\":\"bellydancer\",\"2\":\"8\",\"3\":\"9\",\"4\":\"5\",\"5\":\"7\",\"6\":\"bellydancer\",\"7\":\"0.000\",\"8\":\"1.000\",\"9\":\"0.000\",\"10\":\"-3.7409181\",\"11\":\"-2.2451535\",\"_rn_\":\"2\"},{\"1\":\"bellydancer\",\"2\":\"5\",\"3\":\"10\",\"4\":\"5\",\"5\":\"8\",\"6\":\"bellydancer\",\"7\":\"0.000\",\"8\":\"1.000\",\"9\":\"0.000\",\"10\":\"-4.6125812\",\"11\":\"-1.4855391\",\"_rn_\":\"3\"},{\"1\":\"bellydancer\",\"2\":\"6\",\"3\":\"10\",\"4\":\"6\",\"5\":\"8\",\"6\":\"bellydancer\",\"7\":\"0.000\",\"8\":\"1.000\",\"9\":\"0.000\",\"10\":\"-5.0997285\",\"11\":\"-0.7157145\",\"_rn_\":\"4\"},{\"1\":\"bellydancer\",\"2\":\"7\",\"3\":\"8\",\"4\":\"7\",\"5\":\"9\",\"6\":\"bellydancer\",\"7\":\"0.000\",\"8\":\"0.997\",\"9\":\"0.003\",\"10\":\"-3.6410910\",\"11\":\"0.7737931\",\"_rn_\":\"5\"},{\"1\":\"politician\",\"2\":\"4\",\"3\":\"4\",\"4\":\"4\",\"5\":\"4\",\"6\":\"politician\",\"7\":\"0.003\",\"8\":\"0.000\",\"9\":\"0.997\",\"10\":\"1.4211625\",\"11\":\"1.3268707\",\"_rn_\":\"6\"},{\"1\":\"politician\",\"2\":\"6\",\"3\":\"4\",\"4\":\"5\",\"5\":\"3\",\"6\":\"politician\",\"7\":\"0.000\",\"8\":\"0.000\",\"9\":\"1.000\",\"10\":\"0.8795037\",\"11\":\"1.8251996\",\"_rn_\":\"7\"},{\"1\":\"politician\",\"2\":\"5\",\"3\":\"5\",\"4\":\"5\",\"5\":\"6\",\"6\":\"politician\",\"7\":\"0.000\",\"8\":\"0.000\",\"9\":\"1.000\",\"10\":\"0.0649649\",\"11\":\"1.2285733\",\"_rn_\":\"8\"},{\"1\":\"politician\",\"2\":\"6\",\"3\":\"6\",\"4\":\"6\",\"5\":\"7\",\"6\":\"politician\",\"7\":\"0.000\",\"8\":\"0.002\",\"9\":\"0.998\",\"10\":\"-1.3327695\",\"11\":\"1.3335881\",\"_rn_\":\"9\"},{\"1\":\"politician\",\"2\":\"4\",\"3\":\"5\",\"4\":\"6\",\"5\":\"5\",\"6\":\"politician\",\"7\":\"0.000\",\"8\":\"0.000\",\"9\":\"1.000\",\"10\":\"-0.4377699\",\"11\":\"3.1513263\",\"_rn_\":\"10\"},{\"1\":\"admin\",\"2\":\"3\",\"3\":\"1\",\"4\":\"1\",\"5\":\"2\",\"6\":\"admin\",\"7\":\"1.000\",\"8\":\"0.000\",\"9\":\"0.000\",\"10\":\"5.6299532\",\"11\":\"-0.1411021\",\"_rn_\":\"11\"},{\"1\":\"admin\",\"2\":\"5\",\"3\":\"3\",\"4\":\"1\",\"5\":\"5\",\"6\":\"admin\",\"7\":\"1.000\",\"8\":\"0.000\",\"9\":\"0.000\",\"10\":\"3.8243665\",\"11\":\"-2.6236501\",\"_rn_\":\"12\"},{\"1\":\"admin\",\"2\":\"4\",\"3\":\"2\",\"4\":\"2\",\"5\":\"5\",\"6\":\"admin\",\"7\":\"1.000\",\"8\":\"0.000\",\"9\":\"0.000\",\"10\":\"4.3152925\",\"11\":\"-0.4427117\",\"_rn_\":\"13\"},{\"1\":\"admin\",\"2\":\"7\",\"3\":\"1\",\"4\":\"2\",\"5\":\"4\",\"6\":\"admin\",\"7\":\"1.000\",\"8\":\"0.000\",\"9\":\"0.000\",\"10\":\"5.1869557\",\"11\":\"-1.2023261\",\"_rn_\":\"14\"},{\"1\":\"admin\",\"2\":\"6\",\"3\":\"3\",\"4\":\"3\",\"5\":\"3\",\"6\":\"admin\",\"7\":\"0.982\",\"8\":\"0.000\",\"9\":\"0.018\",\"10\":\"2.7799729\",\"11\":\"-0.2025683\",\"_rn_\":\"15\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nwith(active.2, table(obs = job, pred = class))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             pred\nobs           admin bellydancer politician\n  admin           5           0          0\n  bellydancer     0           5          0\n  politician      0           0          5\n```\n\n\n:::\n:::\n\n\n\n\nEveryone correctly classified.\n\n## Plotting LDs\n\n\\small\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggplot(active.2, aes(x = x.LD1, y = x.LD2, colour = job, label = job)) + \n  geom_point() + geom_text_repel() + guides(colour = \"none\")\ng\n```\n\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/bDiscrim-32-1.png){width=960}\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Biplot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggbiplot(active.1, groups = active$job)\n```\n\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/bDiscrim-33-1.png){width=960}\n:::\n:::\n\n\n\n\n## Comments on plot\n\n-   Groups well separated: bellydancers top left, administrators top\n    right, politicians lower middle.\n\n-   Bellydancers most negative on `LD1`: like dancing most.\n\n-   Administrators most positive on `LD1`: like dancing least.\n\n-   Politicians most negative on `LD2`: like TV-watching most.\n\n## Plotting individual `persons`\n\nMake `label` be identifier of person. Now need legend:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nactive.2 %>% mutate(person = row_number()) %>% \n  ggplot(aes(x = x.LD1, y = x.LD2,  colour = job, \n               label = person)) + \n  geom_point() + geom_text_repel()\n```\n\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/bDiscrim-34-1.png){width=960}\n:::\n:::\n\n\n\n\n## Posterior probabilities\n\n\\scriptsize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nactive.2 %>% mutate(across(starts_with(\"posterior\"), \\(p) round(p, 3))) %>% \n  select(job, class, starts_with(\"posterior\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"job\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"class\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"posterior.admin\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.bellydancer\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.politician\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"bellydancer\",\"2\":\"bellydancer\",\"3\":\"0.000\",\"4\":\"1.000\",\"5\":\"0.000\",\"_rn_\":\"1\"},{\"1\":\"bellydancer\",\"2\":\"bellydancer\",\"3\":\"0.000\",\"4\":\"1.000\",\"5\":\"0.000\",\"_rn_\":\"2\"},{\"1\":\"bellydancer\",\"2\":\"bellydancer\",\"3\":\"0.000\",\"4\":\"1.000\",\"5\":\"0.000\",\"_rn_\":\"3\"},{\"1\":\"bellydancer\",\"2\":\"bellydancer\",\"3\":\"0.000\",\"4\":\"1.000\",\"5\":\"0.000\",\"_rn_\":\"4\"},{\"1\":\"bellydancer\",\"2\":\"bellydancer\",\"3\":\"0.000\",\"4\":\"0.997\",\"5\":\"0.003\",\"_rn_\":\"5\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.003\",\"4\":\"0.000\",\"5\":\"0.997\",\"_rn_\":\"6\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.000\",\"4\":\"0.000\",\"5\":\"1.000\",\"_rn_\":\"7\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.000\",\"4\":\"0.000\",\"5\":\"1.000\",\"_rn_\":\"8\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.000\",\"4\":\"0.002\",\"5\":\"0.998\",\"_rn_\":\"9\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.000\",\"4\":\"0.000\",\"5\":\"1.000\",\"_rn_\":\"10\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"1.000\",\"4\":\"0.000\",\"5\":\"0.000\",\"_rn_\":\"11\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"1.000\",\"4\":\"0.000\",\"5\":\"0.000\",\"_rn_\":\"12\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"1.000\",\"4\":\"0.000\",\"5\":\"0.000\",\"_rn_\":\"13\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"1.000\",\"4\":\"0.000\",\"5\":\"0.000\",\"_rn_\":\"14\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"0.982\",\"4\":\"0.000\",\"5\":\"0.018\",\"_rn_\":\"15\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\nNot much doubt.\n\n## Cross-validating the jobs-activities data\n\nRecall: no need for `predict`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- lda(job ~ reading + dance + tv + ski, data = active, CV = TRUE)\nactive.3 <- cbind(active, class = p$class, posterior = p$posterior)\nwith(active.3, table(obs = job, pred = class))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             pred\nobs           admin bellydancer politician\n  admin           5           0          0\n  bellydancer     0           4          1\n  politician      0           0          5\n```\n\n\n:::\n:::\n\n\n\n\nThis time one of the bellydancers was classified as a politician.\n\n## and look at the posterior probabilities\n\n\\scriptsize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nactive.3 %>% \n  mutate(across(starts_with(\"posterior\"), \\(p) round(p, 3))) %>% \n  select(job, class, starts_with(\"post\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"job\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"class\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"posterior.admin\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.bellydancer\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.politician\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"bellydancer\",\"2\":\"bellydancer\",\"3\":\"0.000\",\"4\":\"1.000\",\"5\":\"0.000\",\"_rn_\":\"1\"},{\"1\":\"bellydancer\",\"2\":\"bellydancer\",\"3\":\"0.000\",\"4\":\"1.000\",\"5\":\"0.000\",\"_rn_\":\"2\"},{\"1\":\"bellydancer\",\"2\":\"bellydancer\",\"3\":\"0.000\",\"4\":\"1.000\",\"5\":\"0.000\",\"_rn_\":\"3\"},{\"1\":\"bellydancer\",\"2\":\"bellydancer\",\"3\":\"0.000\",\"4\":\"1.000\",\"5\":\"0.000\",\"_rn_\":\"4\"},{\"1\":\"bellydancer\",\"2\":\"politician\",\"3\":\"0.000\",\"4\":\"0.001\",\"5\":\"0.999\",\"_rn_\":\"5\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.006\",\"4\":\"0.000\",\"5\":\"0.994\",\"_rn_\":\"6\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.001\",\"4\":\"0.000\",\"5\":\"0.999\",\"_rn_\":\"7\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.000\",\"4\":\"0.000\",\"5\":\"1.000\",\"_rn_\":\"8\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.000\",\"4\":\"0.009\",\"5\":\"0.991\",\"_rn_\":\"9\"},{\"1\":\"politician\",\"2\":\"politician\",\"3\":\"0.000\",\"4\":\"0.000\",\"5\":\"1.000\",\"_rn_\":\"10\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"1.000\",\"4\":\"0.000\",\"5\":\"0.000\",\"_rn_\":\"11\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"1.000\",\"4\":\"0.000\",\"5\":\"0.000\",\"_rn_\":\"12\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"1.000\",\"4\":\"0.000\",\"5\":\"0.000\",\"_rn_\":\"13\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"1.000\",\"4\":\"0.000\",\"5\":\"0.000\",\"_rn_\":\"14\"},{\"1\":\"admin\",\"2\":\"admin\",\"3\":\"0.819\",\"4\":\"0.000\",\"5\":\"0.181\",\"_rn_\":\"15\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Comments\n\n-   Bellydancer was \"definitely\" a politician!\n\n-   One of the administrators might have been a politician too.\n\n## Why did things get misclassified?\n\n::: columns\n::: {.column width=\"40%\"}\nGo back to plot of discriminant scores:\n\n-   one bellydancer much closer to the politicians,\n\n-   one administrator a bit closer to the politicians.\n:::\n\n::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n\n:::\n:::\n\n## Example 4: remote-sensing data\n\n-   View 25 crops from air, measure 4 variables `x1-x4`.\n\n-   Go back and record what each crop was.\n\n-   Can we use the 4 variables to distinguish crops?\n\n## The data\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_url <- \"http://ritsokiguess.site/datafiles/remote-sensing.txt\"\ncrops <- read_table(my_url)\ncrops %>% print(n = 25)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 25 × 6\n   crop          x1    x2    x3    x4 cr   \n   <chr>      <dbl> <dbl> <dbl> <dbl> <chr>\n 1 Corn          16    27    31    33 r    \n 2 Corn          15    23    30    30 r    \n 3 Corn          16    27    27    26 r    \n 4 Corn          18    20    25    23 r    \n 5 Corn          15    15    31    32 r    \n 6 Corn          15    32    32    15 r    \n 7 Corn          12    15    16    73 r    \n 8 Soybeans      20    23    23    25 y    \n 9 Soybeans      24    24    25    32 y    \n10 Soybeans      21    25    23    24 y    \n11 Soybeans      27    45    24    12 y    \n12 Soybeans      12    13    15    42 y    \n13 Soybeans      22    32    31    43 y    \n14 Cotton        31    32    33    34 t    \n15 Cotton        29    24    26    28 t    \n16 Cotton        34    32    28    45 t    \n17 Cotton        26    25    23    24 t    \n18 Cotton        53    48    75    26 t    \n19 Cotton        34    35    25    78 t    \n20 Sugarbeets    22    23    25    42 g    \n21 Sugarbeets    25    25    24    26 g    \n22 Sugarbeets    34    25    16    52 g    \n23 Sugarbeets    54    23    21    54 g    \n24 Sugarbeets    25    43    32    15 g    \n25 Sugarbeets    26    54     2    54 g    \n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Discriminant analysis\n\n\\tiny\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrops.1 <- lda(crop ~ x1 + x2 + x3 + x4, data = crops)\ncrops.1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\nlda(crop ~ x1 + x2 + x3 + x4, data = crops)\n\nPrior probabilities of groups:\n      Corn     Cotton   Soybeans Sugarbeets \n      0.28       0.24       0.24       0.24 \n\nGroup means:\n                 x1       x2       x3       x4\nCorn       15.28571 22.71429 27.42857 33.14286\nCotton     34.50000 32.66667 35.00000 39.16667\nSoybeans   21.00000 27.00000 23.50000 29.66667\nSugarbeets 31.00000 32.16667 20.00000 40.50000\n\nCoefficients of linear discriminants:\n           LD1          LD2           LD3\nx1  0.14077479  0.007780184 -0.0312610362\nx2  0.03006972  0.007318386  0.0085401510\nx3 -0.06363974 -0.099520895 -0.0005309869\nx4 -0.00677414 -0.035612707  0.0577718649\n\nProportion of trace:\n   LD1    LD2    LD3 \n0.8044 0.1832 0.0124 \n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Assessing\n\n-   3 LDs (four variables, four groups).\n\n-   1st two important.\n\n-   `LD1` mostly `x1` (plus)\n\n-   `LD2` `x3` (minus)\n\n## Predictions\n\n-   Thus:\n\n\\footnotesize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- predict(crops.1)\ncrops.2 <- cbind(crops, p)\nwith(crops.2, table(obs = crop, pred = class))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            pred\nobs          Corn Cotton Soybeans Sugarbeets\n  Corn          6      0        1          0\n  Cotton        0      4        2          0\n  Soybeans      2      0        3          1\n  Sugarbeets    0      0        3          3\n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n-   Not very good, eg. only half the Soybeans and Sugarbeets classified\n    correctly.\n\n## Plotting the LDs\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crops.2, aes(x = x.LD1, y = x.LD2, colour = crop)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/piacentini-1.png){width=960}\n:::\n:::\n\n\n\n\nCorn (red) mostly left, cotton (green) sort of right, soybeans and\nsugarbeets (blue and purple) mixed up.\n\n## Biplot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggbiplot(crops.1, groups = crops$crop)\n```\n\n::: {.cell-output-display}\n![](discrim_files/figure-revealjs/bDiscrim-45-1.png){width=960}\n:::\n:::\n\n\n\n\n## Comments\n\n-   Corn low on LD1 (left), hence low on `x1`\n\n-   Cotton tends to be high on LD1 (high `x1`)\n\n-   one cotton very low on LD2 (high `x3`?)\n\n-   Rather mixed up.\n\n## Posterior probs (some)\n\n\\scriptsize\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrops.2 %>% mutate(across(starts_with(\"posterior\"), \\(p) round(p, 3))) %>% \n  filter(crop != class) %>% \n  select(crop, class, starts_with(\"posterior\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"crop\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"class\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"posterior.Corn\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.Cotton\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.Soybeans\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"posterior.Sugarbeets\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Corn\",\"2\":\"Soybeans\",\"3\":\"0.443\",\"4\":\"0.034\",\"5\":\"0.494\",\"6\":\"0.029\",\"_rn_\":\"4\"},{\"1\":\"Soybeans\",\"2\":\"Sugarbeets\",\"3\":\"0.010\",\"4\":\"0.107\",\"5\":\"0.299\",\"6\":\"0.584\",\"_rn_\":\"11\"},{\"1\":\"Soybeans\",\"2\":\"Corn\",\"3\":\"0.684\",\"4\":\"0.009\",\"5\":\"0.296\",\"6\":\"0.011\",\"_rn_\":\"12\"},{\"1\":\"Soybeans\",\"2\":\"Corn\",\"3\":\"0.467\",\"4\":\"0.199\",\"5\":\"0.287\",\"6\":\"0.047\",\"_rn_\":\"13\"},{\"1\":\"Cotton\",\"2\":\"Soybeans\",\"3\":\"0.056\",\"4\":\"0.241\",\"5\":\"0.379\",\"6\":\"0.324\",\"_rn_\":\"15\"},{\"1\":\"Cotton\",\"2\":\"Soybeans\",\"3\":\"0.066\",\"4\":\"0.138\",\"5\":\"0.489\",\"6\":\"0.306\",\"_rn_\":\"17\"},{\"1\":\"Sugarbeets\",\"2\":\"Soybeans\",\"3\":\"0.381\",\"4\":\"0.146\",\"5\":\"0.395\",\"6\":\"0.078\",\"_rn_\":\"20\"},{\"1\":\"Sugarbeets\",\"2\":\"Soybeans\",\"3\":\"0.106\",\"4\":\"0.144\",\"5\":\"0.518\",\"6\":\"0.232\",\"_rn_\":\"21\"},{\"1\":\"Sugarbeets\",\"2\":\"Soybeans\",\"3\":\"0.088\",\"4\":\"0.207\",\"5\":\"0.489\",\"6\":\"0.216\",\"_rn_\":\"24\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\\normalsize\n\n## Comments\n\n-   These were the misclassified ones, but the posterior probability of\n    being correct was not usually too low.\n\n-   The correctly-classified ones are not very clear-cut either.\n\n## MANOVA\n\nBegan discriminant analysis as a followup to MANOVA. Do our variables\nsignificantly separate the crops?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresponse <- with(crops, cbind(x1, x2, x3, x4))\ncrops.manova <- manova(response ~ crop, data = crops)\nsummary(crops.manova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          Df Pillai approx F num Df den Df  Pr(>F)  \ncrop       3 0.9113   2.1815     12     60 0.02416 *\nResiduals 21                                        \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n## Box's M test\n\nWe should also run Box's M test to check for equal variance of each\nvariable across crops:\n\n\\small\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(BoxM(response, crops$crop))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       Box's M Test \n\nChi-Squared Value = 69.42634 , df = 30  and p-value: 5.79e-05 \n```\n\n\n:::\n:::\n\n\n\n\n\\normalsize\n\n-   The P-value for the M test is smaller even than our guideline of\n    0.001. So we should not take the MANOVA seriously.\n\n-   *Apparently* at least one of the crops differs (in means) from the\n    others. So it is worth doing this analysis.\n\n-   We did this the wrong way around, though!\n\n## The right way around\n\n-   *First*, do a MANOVA to see whether any of the groups differ\n    significantly on any of the variables.\n\n-   Check that the MANOVA is believable by using Box's M test.\n\n-   *If the MANOVA is significant*, do a discriminant analysis in the\n    hopes of understanding how the groups are different.\n\n-   For remote-sensing data (without Clover):\n\n    -   LD1 a fair bit more important than LD2 (definitely ignore LD3).\n\n    -   LD1 depends mostly on `x1`, on which Cotton was high and Corn\n        was low.\n\n-   Discriminant analysis in MANOVA plays the same kind of role that\n    Tukey does in ANOVA.\n",
    "supporting": [
      "discrim_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"discrim_files/libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"discrim_files/libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}